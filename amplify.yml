version: 1
applications:
    - frontend:
          phases:
              preBuild:
                  commands:
                      - echo "Installing dependencies..."
                      - npm ci
                      - echo "Setting up build environment..."
                      - chmod +x scripts/setup-build-env.sh
                      - ./scripts/setup-build-env.sh
                      - echo "Generating Prisma client..."
                      - npx prisma generate
              build:
                  commands:
                      - echo "Building Next.js application..."
                      - npm run build
              postBuild:
                  commands:
                      - echo "Build completed successfully!"
                      - echo "Final environment check..."
                      - echo "Checking DATABASE_URL..."
                      - if [ -z "$DATABASE_URL" ]; then echo "ERROR: DATABASE_URL is not set"; exit 1; else echo "DATABASE_URL is set"; fi
                      - echo "Checking NEXTAUTH_SECRET..."
                      - if [ -z "$NEXTAUTH_SECRET" ]; then echo "ERROR: NEXTAUTH_SECRET is not set"; exit 1; else echo "NEXTAUTH_SECRET is set"; fi
                      - echo "All required environment variables are set"
          artifacts:
              baseDirectory: .next
              files:
                  - "**/*"
          cache:
              paths:
                  - node_modules/**/*
                  - .next/cache/**/*
                  - .next/static/**/*
