version: 1
frontend:
    phases:
        preBuild:
            commands:
                - echo "=== Pre-Build Phase ==="
                - echo "Node.js version:" $(node --version)
                - echo "NPM version:" $(npm --version)
                - echo "Installing dependencies..."
                - npm ci
                - echo "Validating environment variables..."
                - npm run validate-env
        build:
            commands:
                - echo "=== Build Phase ==="
                - echo "Building Next.js application..."
                - npm run build:amplify
        postBuild:
            commands:
                - echo "=== Post Build Phase ==="
                - echo "Build completed successfully"
                - echo "Listing build output..."
                - ls -la .next/ || echo "No .next directory found"
                - echo "Checking for static export..."
                - ls -la out/ || echo "No out directory found"
    artifacts:
        baseDirectory: .next
        files:
            - "**/*"
    cache:
        paths:
            - node_modules/**/*
            - .next/cache/**/*
